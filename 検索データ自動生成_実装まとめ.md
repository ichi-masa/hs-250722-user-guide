# 検索データ自動生成の実装まとめ

## 背景・課題

### 現状の問題
- このプロジェクトは**26言語**に対応する必要がある
- 現在、検索機能のために各ページの検索データ（JSON）を**手動で作成**している
- 各言語ごとに以下の作業が必要：
  1. HTMLファイルを翻訳
  2. **検索用JSONファイルも手動で翻訳** ← これが大変！

### 手動作業の問題点
- 26言語分のJSONファイルを手動で作成・翻訳するのは現実的ではない
- HTMLにある本文を、再度JSONにコピーする二度手間
- ミスが発生しやすい
- 更新時も毎回手作業が必要

---

## 解決策

**HTMLファイルから自動的に検索用JSONを生成するNode.jsスクリプトを作成**

### メリット
- 翻訳作業は**HTMLファイルだけ**でOK
- コマンド1つで**26言語すべて**のJSONを自動生成
- 手作業による翻訳ミスがなくなる
- 更新時も簡単（コマンド実行するだけ）

---

## 実装内容

### 作成したファイル

#### 1. `generate-search-data.js`
HTMLファイルから検索データを自動生成するNode.jsスクリプト

**処理の流れ：**
1. `dist`フォルダ内のすべての言語フォルダを検索
2. 各HTMLファイルから以下を抽出：
   - タイトル（`<title>`タグ）
   - 説明文（`<meta name="description">`）
   - 本文（`.l-main`内のテキスト、不要な要素を除外）
3. JSON形式で保存（`assets/data/searchdata-[言語].json`）

**使用技術：**
- **Node.js**: JavaScriptの実行環境
- **Cheerio**: HTMLパース用ライブラリ（jQueryライクな記法でHTMLを操作）
- **fs/path**: ファイル操作用の標準モジュール

**重要：Gulpは不要**
- このスクリプトはNode.jsだけで動作します
- Gulpの環境がなくても実行可能
- 先方はNode.jsをインストールするだけで使えます

#### 2. `SEARCH-DATA-README.md`
先方向けの使い方マニュアル

---

## 必要な環境

### 開発側（あなた）
- Node.js 18以上
- npm（Node.jsに付属）

### 先方（翻訳後）
- Node.js 18以上のみ
- npm（Node.jsに付属）
- **Gulpは不要**

---

## 使い方

### 開発時（あなたの作業）

```bash
# 1. 必要なパッケージをインストール（初回のみ）
npm install

# 2. HTMLをビルド
gulp build

# 3. 検索データを生成
node generate-search-data.js
```

実行結果：
```
[INFO] 見つかった言語: en-GB

[INFO] en-GB: 32ファイルを処理中...
[SUCCESS] 生成完了: assets/data/searchdata-en-GB.json (32ページ)

[COMPLETE] 1言語、合計32ページの検索データを生成しました。
```

### 納品後（先方の作業）

```bash
# 1. 初回のみ：パッケージをインストール
npm install

# 2. HTMLファイルを翻訳

# 3. 検索データを生成
node generate-search-data.js
```

**たったこれだけで26言語すべての検索データが自動生成されます。**

---

## 作業量の比較

### Before（手動作成）
| 作業 | 時間（目安） |
|------|--------------|
| HTMLを翻訳 | 各言語あたり数時間 |
| JSONを手動で翻訳 | 各言語あたり1-2時間 |
| 合計（26言語） | 26-52時間 |

### After（自動生成）
| 作業 | 時間（目安） |
|------|--------------|
| HTMLを翻訳 | 各言語あたり数時間 |
| コマンド実行 | 30秒 |
| 合計（26言語） | 30秒 |

**削減時間：約26-52時間**

---

## 技術的な詳細

### Cheerioとは
- Node.js上でHTMLを操作できるライブラリ
- jQueryと同じような記法で使える
- 軽量・高速
- Web scraping（HTMLからデータ抽出）の業界標準

### なぜCheerioを使うのか

#### Cheerioなしの場合（正規表現）
```javascript
// 複雑で読みづらい
const titleMatch = html.match(/<title>(.*?)<\/title>/);
const title = titleMatch ? titleMatch[1] : '';

// ネストしたタグに対応できない
html.replace(/<div class="l-header">.*?<\/div>/g, '');
```

#### Cheerioありの場合
```javascript
// シンプルで読みやすい
const title = $('title').text();

// ネストしたタグも簡単に削除
$('.l-header').remove();
```

**コード量：約1/5に削減**

---

## ファイル構成

```
プロジェクトルート/
├── generate-search-data.js     ← 自動生成スクリプト
├── SEARCH-DATA-README.md       ← 先方向けマニュアル
├── package.json                ← cheerioの依存関係を追加
├── package-lock.json           ← バージョン固定
├── gulpfile.js                 ← 開発環境用（先方不要）
└── dist/
    ├── en-GB/
    │   ├── index.html
    │   ├── how-to-use.html
    │   └── assets/data/
    │       └── searchdata-en-GB.json  ← 自動生成
    ├── ja-JP/
    │   └── assets/data/
    │       └── searchdata-ja-JP.json  ← 自動生成
    └── ...（他の24言語も同様）
```

---

## 今後の運用

### 新しいページを追加する場合
1. HTMLファイルを作成
2. `gulp build`（開発側）
3. `node generate-search-data.js`

→ 自動的に検索データに追加されます

### ページ内容を更新する場合
1. HTMLファイルを修正
2. `gulp build`（開発側）
3. `node generate-search-data.js`

→ 検索データも自動的に更新されます

---

## 注意点

### 先方への依頼事項
1. **Node.jsのインストール**が必要
   - [Node.js公式サイト](https://nodejs.org/)からダウンロード
   - インストール後、ターミナル（コマンドプロンプト）で確認：
     ```bash
     node -v  # バージョンが表示されればOK
     ```

2. **初回のみ`npm install`を実行**
   - プロジェクトフォルダで実行
   - 必要なツール（cheerio）がインストールされる
   - Gulpはインストールされません

3. **HTMLを翻訳した後、`node generate-search-data.js`を実行**

### トラブルシューティング
- エラーが出た場合は`SEARCH-DATA-README.md`を参照
- 解決しない場合はお問い合わせください

---

## 導入効果

### 定量的効果
- 翻訳作業時間：約26-52時間削減
- エラー率：手動ミスがゼロに
- 更新時間：数時間 → 30秒

### 定性的効果
- 翻訳者の負担軽減
- 品質の安定化
- メンテナンス性の向上
- スケーラビリティの確保（言語追加が容易）

---

## まとめ

### やったこと
HTMLから検索データ（JSON）を自動生成するNode.jsスクリプトを作成

### 使う技術
- Node.js
- Cheerio（HTMLパース用ライブラリ）

### メリット
- 26言語の翻訳作業が大幅に効率化
- 手作業による翻訳が不要に
- コマンド1つで全言語対応
- Gulp不要でシンプル

### 先方にお願いすること
- Node.jsのインストール
- HTMLを翻訳後、コマンド実行（`node generate-search-data.js`）

---

## サポート

ご不明点がございましたら、お気軽にお問い合わせください。

---

**作成日**: 2025年
**バージョン**: 1.0
